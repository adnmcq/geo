{% extends "base.html" %}

{% block content %}
 <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Overview</h1>
<!--        <div class="btn-toolbar mb-2 mb-md-0">-->
<!--          <div class="btn-group mr-2">-->
<!--            <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>-->
<!--            <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>-->
<!--          </div>-->
<!--          <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">-->
<!--            <span data-feather="calendar"></span>-->
<!--          </button>-->

<!--        </div>-->
      </div>
      <!--<canvas class="my-4 w-100" id="myChart" width="900" height="380"></canvas>-->
        <div id='map' style='width: 100%; height: 380px;'></div>

      <h2>Trips</h2>
<table id="loads" class="display" style="width:100%">
        <thead>
            <tr>
                <th>Tracker</th>

                <th>Origin</th>
                <th>Destination</th>
                <th>Last Check</th>
                <th>Check Time</th>
                <th>Active</th>

            </tr>
        </thead>
        <tbody>
        </tbody>
<!--        <tfoot>-->
<!--            <tr>-->
<!--                <th>Name</th>-->
<!--            </tr>-->
<!--        </tfoot>-->
    </table>



      <h2>Trackers</h2>
<table id="trackers" class="display" style="width:100%">
        <thead>
            <tr>
                <th>DeviceName</th>
                <th>TrackerId</th>
                <th>CreatedDt</th>
<!--                <th>Client</th>-->

            </tr>
        </thead>
        <tbody>
        </tbody>
<!--        <tfoot>-->
<!--            <tr>-->
<!--                <th>Name</th>-->
<!--            </tr>-->
<!--        </tfoot>-->
    </table>






      </div>
{% endblock %}


{% block js %}

// $(<parent>).on('<event>', '<child>', callback);
$(document).on('change', '.trip_checkbox', function() {
    if(this.checked) {
      // checkbox is checked

    var trip_id = $(this).attr("id");
    console.log(trip_id);

    $.post( "{% url 'add_trip_to_map' %}", { trip_id: trip_id }, function( data ) {
console.log(data);
    data = JSON.parse(data);
    //console.log(data["dest_lon"]);

        lon=data["dest_lon"];
    lon=-43;

            lat=data["dest_lat"];
    lat=-43;

    var marker = new mapboxgl.Marker()
.setLngLat([data["dest_lat"], lon])
.addTo(map);


});


    } //end if checked
});

//map stuff
        mapboxgl.accessToken = '{{ mapbox_token }}';
        var map = new mapboxgl.Map({
          container: 'map',
          style: 'mapbox://styles/mapbox/streets-v11',
          center: [-101.641, 39.366],
          zoom: 3
        });

        {% for key, value in devices.items %}
        var {{key}} = new mapboxgl.Marker()
          .setLngLat([{{ value.CheckPoint_Location.4 }}, {{ value.CheckPoint_Location.3 }}])
          .addTo(map);
        {% endfor %}

// datatables
    var oTable = $('#trackers').dataTable({
        // ...
        "processing": true,
        "serverSide": true,
        "ajax": "{% url 'tracker_list_json' %}"
    });
    // ...

    var oTable2 = $('#loads').dataTable({
        // ...
        "processing": true,
        "serverSide": true,
        "ajax": "{% url 'trip_list_json' %}"
    });
    // ...



{% endblock %}